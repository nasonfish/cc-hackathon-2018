{% extends "base-scaffolding.html" %}
{% block title %}Class {{ notecard.cls.name }} ({{ notecard.cls.teacher.nice_name }}){% endblock %}
{% block content %}
<h3 id="title-edit">
    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> <span class="inner-text">{{ notecard.title }}</span>
</h3>
<p id="description-edit">
    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> <span class="inner-text">{{ notecard.description }}</span>
</p>
<table class="table table-striped">
    <tr>
        <th class="span2">Text</th>
        <th class="span8">Description</th>
        <th class="span2">Actions</th>
    </tr>
{% for card in notecard.cards %}
    <tr>
        <td data-raw="{{ card.text }}" class="span3 notecard-text card-{{ card.id }}">{{ card.text }}</td>
        <td data-raw="{{ card.value }}" class="span6 notecard-value card-{{ card.id }}">{{ card.value |markdown |safe }}</td>
        <td><a href="{{ url_for('class.notecard_card_delete', id=notecard.cls.id, card_id=notecard.id, card_card_id=card.id) }}"
               class="span3 btn btn-danger">Delete Card</a>
            <button class="btn btn-info edit-card" data-id="{{ card.id }}">Edit card</button>
        </td>
    </tr>
{% endfor %}
</table>
<form method="post" action="{{ url_for('.notecard_submit', id=notecard.cls.id, card_id=notecard.id) }}">
    <label for="content-text">Name: </label>
    <input id="content-text" name="text"/>
    <label for="content-value">Value: </label>
    <textarea id="content-value" name="value" cols="50" rows="15"></textarea>
    <button type="submit">Submit</button>
</form>
{% endblock %}
{% block breadcrumbs %}
        <li><a href="{{ url_for('class.list') }}">Class</a></li>
        <li><a href="{{ url_for('class.view', id=notecard.cls_id) }}">{{ notecard.cls.name }}</a></li>
        <li><a href="{{ url_for('class.unit', id=notecard.cls_id, unit_id=notecard.unit_id) }}">{{ notecard.unit.name }}</a></li>
        <li><a href="{{ url_for('class.subject', id=notecard.cls_id, subject_id=notecard.subject_id) }}">{{ notecard.subject.name }}</a></li>
        <li class="active">{{ notecard.title }}</li>
{% endblock %}
{% block js %}
    var editing = function(){
        var id = $(this).attr("data-id");
        var text = $(".notecard-text.card-" + id);
        text.html("<input value='"+text.attr("data-raw")+"'/>");
        var value = $(".notecard-value.card-" + id);
        value.html("<textarea>" + value.attr("data-raw") + "</textarea>");
        $(this).removeClass("edit-card btn-info").addClass("submit-card btn-success").html("Submit Card").unbind().click(function(){
            console.log("submit clicked");
            var submitText = text.children().val();
            var submitValue = value.children().val();
            $.post("{{ url_for('class.ajax_notecard_card_edit', id=notecard.cls_id, card_id=notecard.id, card_card_id='') }}" + id,
                {"text": submitText, "value": submitValue},
                function(data){
                    text.html(data['text']).attr("data-raw", data['text'])
                    value.html(data['value']).attr("data-raw", data['value_raw']);
                }, "json"
            );
            $(this).removeClass("submit-card btn-success").addClass("edit-card btn-info").html("Edit Card").unbind().click(editing);
        });
    };
    $(".edit-card").click(editing);
    var edit_elem = function(){

    }
    $("#title-edit")
{% endblock %}
